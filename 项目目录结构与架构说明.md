# 项目目录结构与系统架构说明

## 项目概述
**VulnRisk - 漏洞风险评估平台**
一个基于机器学习的全栈漏洞风险评估系统，用于预测软件漏洞并计算风险评分。

---

## 系统架构图组件说明

### 1. 前端层 (Frontend Layer)
**技术栈**: Vue 3 + TypeScript + Element Plus + ECharts

```
frontend-vue/
├── src/
│   ├── App.vue                 # 主应用组件
│   ├── main.ts                 # 应用入口文件
│   ├── router/
│   │   └── index.ts            # 路由配置
│   ├── services/
│   │   └── api.ts              # API 服务封装 (axios)
│   ├── stores/
│   │   └── auth.ts             # 状态管理 (认证状态)
│   └── views/                  # 页面视图组件
│       ├── Login.vue           # 登录页面
│       ├── Datasets.vue        # 数据集管理页面
│       ├── Models.vue           # 模型管理页面
│       ├── Predictions.vue     # 预测结果页面
│       └── Report.vue          # 报告分析页面
├── public/                     # 静态资源
│   ├── batch_prediction_example.csv
│   └── batch_prediction_example.json
├── Dockerfile                  # 前端容器化配置
├── nginx.conf                  # Nginx 配置
├── vite.config.ts              # Vite 构建配置
└── package.json                # 前端依赖管理
```

**功能模块**:
- 用户认证与授权
- 数据集上传与管理
- 模型训练与激活
- 批量/单个预测
- 风险分析与可视化

---

### 2. 后端层 (Backend Layer)
**技术栈**: Node.js + TypeScript + Express + Prisma + PostgreSQL

```
backend-node/
├── src/
│   ├── server.ts               # Express 服务器入口
│   ├── app.ts                  # Express 应用配置
│   ├── config/
│   │   └── index.ts            # 配置文件管理
│   ├── db/
│   │   └── index.ts            # Prisma 数据库连接
│   ├── middleware/
│   │   └── auth.middleware.ts  # JWT 认证中间件
│   ├── routes/                 # API 路由定义
│   │   ├── auth.ts             # 认证路由
│   │   ├── datasets.ts         # 数据集路由
│   │   ├── models.ts           # 模型路由
│   │   ├── predictions.ts      # 预测路由
│   │   ├── github.ts           # GitHub 集成路由
│   │   └── health.ts           # 健康检查路由
│   ├── controllers/            # 控制器层 (请求处理)
│   │   ├── auth.controller.ts
│   │   ├── dataset.controller.ts
│   │   ├── model.controller.ts
│   │   ├── prediction.controller.ts
│   │   └── github.controller.ts
│   ├── services/               # 业务逻辑层
│   │   ├── auth.service.ts     # 认证服务
│   │   ├── dataset.service.ts # 数据集服务
│   │   ├── model.service.ts   # 模型服务
│   │   ├── prediction.service.ts # 预测服务
│   │   ├── risk.service.ts    # 风险计算服务
│   │   └── github.service.ts  # GitHub 集成服务
│   └── utils/
│       └── ensureDirs.ts      # 工具函数
├── prisma/
│   ├── schema.prisma           # 数据库模式定义
│   └── migrations/             # 数据库迁移文件
│       ├── 20240101000000_init/
│       ├── 20251230143712_add_user_model/
│       └── 20260116192800_add_prediction_explanation_metadata/
├── scripts/                    # 管理脚本
│   ├── create-admin.js         # 创建管理员账号
│   ├── register-model.js       # 注册模型
│   ├── reset-password.js       # 重置密码
│   ├── restore-data.js         # 恢复数据
│   └── verify-password.js     # 验证密码
├── uploads/                    # 文件上传目录
├── Dockerfile                  # 后端容器化配置
└── package.json                # 后端依赖管理
```

**核心功能**:
- RESTful API 服务
- JWT 身份认证
- 数据库 ORM (Prisma)
- 文件上传处理
- 与 ML 服务通信
- GitHub 集成

---

### 3. 机器学习服务层 (ML Service Layer)
**技术栈**: Python + Flask + scikit-learn + XGBoost

```
ml-service/
├── app.py                      # Flask 应用主入口
├── predict.py                  # 预测服务模块
├── risk.py                     # 风险计算模块
├── train.py                    # 模型训练模块
├── train_risk_model.py         # 风险模型训练
├── train_random_forest_config.json  # 随机森林训练配置
├── data_exploration.py         # 数据探索分析
├── infer_unseen_risk.py        # 未知风险推理
├── plot_risk_analysis.py       # 风险分析可视化
├── models/                     # 本地模型存储
├── requirements.txt            # Python 依赖
└── Dockerfile                  # ML 服务容器化配置
```

**核心功能**:
- 模型训练 (RandomForest, XGBoost)
- 预测服务 (单个/批量)
- 风险评分计算
- SMOTE 数据平衡
- 模型持久化 (joblib)

---

### 4. 数据存储层 (Data Storage Layer)

```
models/                         # 训练好的模型存储
├── risk_model_001/
│   ├── model.joblib           # 模型文件
│   ├── vectorizer.joblib      # 特征向量化器
│   ├── metadata.json          # 模型元数据
│   ├── preprocessing_report.json
│   └── training_predictions.csv
├── risk_model_002_smote/
└── risk_model_003_rf/

data/                           # 数据集存储目录

backend-node/uploads/           # 上传文件临时存储
```

**数据库 (PostgreSQL)**:
- Users (用户表)
- Datasets (数据集表)
- Models (模型表)
- Predictions (预测结果表)
- 通过 Prisma ORM 管理

---

### 5. 基础设施层 (Infrastructure Layer)

```
docker-compose.yml              # Docker Compose 编排配置
├── postgres                    # PostgreSQL 数据库容器
├── backend-node                # 后端服务容器
├── ml-service                  # ML 服务容器
└── frontend-vue                # 前端服务容器 (Nginx)

config.yaml                     # 全局配置文件
```

**部署配置**:
- Docker 容器化部署
- Nginx 反向代理
- 服务间网络通信
- 数据卷挂载

---

### 6. 文档与脚本 (Documentation & Scripts)

```
根目录/
├── README.md                   # 项目说明文档
├── README_CN.md                # 中文文档
├── 快速启动指南.md             # 快速启动指南
├── deploy_guide.md            # 部署指南
├── PRODUCTION_DEPLOYMENT_GUIDE.md
├── AUTHENTICATION_SETUP.md    # 认证设置
├── DATABASE_MIGRATION_GUIDE.md
├── start.sh / start.bat        # 启动脚本
├── deploy-production.sh / .bat # 生产部署脚本
└── [其他配置文档...]
```

---

## 系统架构流程图

### 数据流向

```
用户请求
    ↓
前端 (Vue 3) - Port 80
    ↓ HTTP/HTTPS
后端 API (Express) - Port 3000
    ↓
    ├─→ PostgreSQL (Port 5432) - 数据持久化
    │
    └─→ ML Service (Flask) - Port 5000
            ↓
        模型推理/训练
            ↓
        返回预测结果
```

### 核心服务交互

1. **认证流程**: 前端 → 后端 → JWT Token → 前端存储
2. **数据集上传**: 前端 → 后端 → 文件存储 → 数据库记录
3. **模型训练**: 前端 → 后端 → ML Service → 模型保存 → 数据库记录
4. **预测流程**: 前端 → 后端 → ML Service → 风险计算 → 数据库存储 → 前端展示

---

## 技术栈总结

| 层级 | 技术 | 版本/说明 |
|------|------|-----------|
| **前端** | Vue 3 | 3.3.11 |
| | TypeScript | 5.3.3 |
| | Element Plus | 2.5.0 |
| | ECharts | 5.4.3 |
| | Vite | 5.0.8 |
| **后端** | Node.js | 18+ |
| | Express | 4.18.2 |
| | Prisma | 5.7.1 |
| | TypeScript | 5.3.3 |
| **ML服务** | Python | 3.10+ |
| | Flask | 2.3.0+ |
| | scikit-learn | 1.8.0 |
| | XGBoost | 2.0.0+ |
| | imbalanced-learn | 0.11.0+ |
| **数据库** | PostgreSQL | 15-alpine |
| **容器化** | Docker | - |
| | Docker Compose | - |
| **Web服务器** | Nginx | - |

---

## 端口分配

- **80**: 前端 (Nginx)
- **3000**: 后端 API (Express)
- **5000**: ML 服务 (Flask)
- **5432**: PostgreSQL 数据库

---

## 关键设计模式

1. **分层架构**: 前端 → 后端 → ML服务 → 数据库
2. **RESTful API**: 标准化接口设计
3. **JWT 认证**: 无状态身份验证
4. **容器化部署**: Docker Compose 统一管理
5. **ORM 数据访问**: Prisma 简化数据库操作
6. **微服务架构**: ML 服务独立部署

---

## 用于架构图的建议

### 架构图应包含的组件:

1. **用户层**: 浏览器/客户端
2. **前端层**: Vue 3 应用 (Nginx 容器)
3. **API 网关层**: Express 后端服务
4. **业务逻辑层**: 
   - 认证服务
   - 数据集管理服务
   - 模型管理服务
   - 预测服务
5. **ML 服务层**: Flask 机器学习服务
6. **数据存储层**: 
   - PostgreSQL 数据库
   - 文件系统 (模型文件、数据集)
7. **基础设施层**: Docker 容器编排

### 连接关系:

- 用户 ↔ 前端: HTTP/HTTPS
- 前端 ↔ 后端: REST API
- 后端 ↔ 数据库: Prisma ORM
- 后端 ↔ ML服务: HTTP API
- ML服务 ↔ 文件系统: 模型读写
- 所有服务: Docker 网络通信

---

此文档可用于绘制系统架构图，包含完整的目录结构和技术栈信息。

